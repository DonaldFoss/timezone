<!DOCTYPE html>
<html>
<head>
<title>synopsis.js</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link rel="stylesheet" media="all" href="/ace/css/docco.css">
</head>
<body>
<div id="container">
<div id="background"></div>
  <table cellspacing="0" cellpadding="0">
    <thead>
      <tr>
        <th class="docs"><h1>synopsis.js</th>
        <th class="code"></th>
      </tr>
    </thead>
    <tbody>
      
        <tr>
          <td class="docs"><p>A walk-though of <strong>Timezone</strong>, a database friendly, timezone aware replacement
for the <code>Date</code> object that implements timezone conversions, timezone aware
date math, timezone and locale aware date formatting, for any date, anywhere
in the world, since the dawn of standardized time. </p>

<p><strong>Timezone</strong> is a JavaScript library with no dependencies. It runs in the
browser and in Node.js. This walk-through is written for Node.js. You can run
this JavaScript program at the command line like so:</p>

<p><code>
node synopsis.js
</code></p></td>
          <td class="code"><div class="highlight"><pre></pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Functional API</h3></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><strong>Timezone</strong> is a function. When you import <strong>Timezone</strong>, try assigning it to
a terse variable name. We recommend <code>tz</code>.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"></td>
          <td class="code"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">ok</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">tz</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;timezone&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>POSIX Time</h3>

<p><strong>Timezone</strong> replaces the JavaScript <code>Date</code> object with <a href="http://en.wikipedia.org/wiki/Unix_time">POSIX
time</a> &mdash; milliseconds since the
epoch in UTC &mdash; for a cross-platform, internationalized, and durable
representation of a point in time.</p>

<p>POSIX time is simple. POSIX time is always an integer. POSIX time is easy
store.  POSIX time is easy to sort. POSIX time is easy to compare.</p>

<p>POSIX time is absolute. It always represents a time in UTC.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Timezone returns number representing POSIX time by default.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">y2k</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-01&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Unless you provide a format specifier, the return value of a call to the
<strong>Timezone</strong> function will be POSIX time.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>The POSIX time number is always an integer, usually quite large.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">y2k</span> <span class="o">==</span>  <span class="mi">946684800000</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>The JavaScript <code>Date.UTC</code> function also creates a number representing POSIX
time, so we can use it check our work in our synopsis.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Did <strong>Timezone</strong> give us the correct POSIX time for 2000?</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">y2k</span> <span class="o">==</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>POSIX time is milliseconds since the epoch in UTC. The epoch is New Year's
1970. POSIX time for dates before 1970 are negative. POSIX time for dates
after 1970 are positive.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>The epoch is January 1st, 1970 UTC.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1970-01-01&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Apollo 11 was before the epoch.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1969-07-21 02:39&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>America's bicentennial was after the epoch.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1976-07-04&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>We can pass POSIX time as the date argument to the <strong>Timezone</strong> function. The
date argument is always first argument to the <strong>Timezone</strong> function.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Add a millisecond to Y2K.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;+1 millisecond&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Nothing to do, so it returns the same POSIX time value it got.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">)</span> <span class="o">==</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>POSIX time is durable and portable. Any other language you might use, any
database you might use, will have date facilities that work with POSIX time.</p>

<p>We use POSIX time to represents and unambiguous point in time, free of
timezone offsets, daylight savings time; all the whimsical manipulations of
local governments. POSIX time is represented as integer, an efficient data
type that easily sorts and compares.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Date Strings</h3></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><strong>Timezone</strong> uses <a href="http://www.ietf.org/rfc/rfc3339.txt">RFC 3999</a> for date
strings. RFC 3999 is a well-resonsed subset of the ISO 8601 standard, which
is larger than you might imagine. RFC 3999 is the string date format for use
in new Internet protocols going forward. It superceeds the RFC 2822 date
format you're familiar with in HTTP headers.</p>

<p>You've seen us parsing RFC 3999 date strings above. Let's look at a few more
variations.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse an RFC 3999 date with a time in seconds.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-01T00:00:00&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>My goodness, that <code>T</code> is silly. It's part of ISO 8601, but RFC 3999 lets us
replace it with a space so it's easier to read. We're not going to use it
again.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse an RFC 3999 date with a time in seconds, using the optional space to
replace that silly <code>T</code>.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-01 00:00:00&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse an RFC 3999 date with just the date, no time.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-01&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse an RFC 3999 date with the date and a time in minutes.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-01 00:00&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse an RFC 3999 date with a time zone offset.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1999-12-31 00:00-04:00&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>We've gone and extended RFC 3999 for two special cases. First, We've added
milliseconds.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse an RFC 3999 looking date with the date and a time in milliseconds.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-01 00:00:00.0&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Second, we allow timezone offsets to include seconds. You'll see seconds in
the offsets around the turn of the 19th century.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse an RFC 3999 date with a time zone offset with seconds.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1999-12-31 00:00-04:00:00&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>We use RFC 3999 date strings for an easy to type, easy to read, unambiguous
date literal. When we want to type out a date in our code, or store a string
representation in a message header or log file, we use RFC 3999.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Timezones &mdash; Time O' Clock</h3>

<p>When timezones are in play, we're no longer dealing with POSIX time. We're
dealing with time that has been localized so that it matches the time
according to the clock on the user's wall.</p>

<p>That's why we call it wall-clock time.</p>

<p>Wall-clock time is determined according to the laws or rules of a government
or administrative body. Wall-clock time is determined by applying the timezone
offset for the locality, plus any daylight savings offsets.</p>

<p>We don't venture a guess as to what these offsets might be. No. We use the
IANA Timezone Database to convert POSIX time to precisely the best guess of
what the wall-clock of a user's chosen locality might be maybe.</p>

<p>Yes, it's still a guess, because it comes down to a lot of research. However,
the folks on the tz listserv at the IANA, Arthur David Olson, Paul Eggert,
and lots of volunteers, have done their best to keep track of all the rule
changes. They are going to venture a much better guess than our own.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Converting from Wall-Clock Time</h3></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>We first need to load a timezone rule set from the IANA timezone database.
Let's create a <code>tz</code> function that knows about most of the US timezones.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>South American as well, also Canada and Mexico, no Hawaii.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">us</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;zones/America&quot;</span><span class="p">));</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Our new <strong>Timezone</strong> function knows the rules for a lot of timezones. Not
only in the United States, but in Canada, Mexico and all of South America.
We can use these rules to work with wall-clock time.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>If we don't specify a zone name, out new <code>us</code> function will behave just as
old <code>tz</code> function did.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Time of the moon walk in UTC.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">moonwalk</span> <span class="o">=</span> <span class="nx">us</span><span class="p">(</span><span class="s2">&quot;1969-07-21 02:39&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Does</em> <code>Date.UTC</code> <em>agree?</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">us</span><span class="p">(</span><span class="s2">&quot;1969-07-21 02:39&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">(</span><span class="mi">1969</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">39</span><span class="p">)</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>However, if we name a zone rule set, we will parse that RFC 3999 date as
wall-clock time, not UTC. Here we use the <code>"America/Detroit"</code> timezone rule
set to parse 10:39 PM wall-clock time the day before the moon walk.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Hope the kids got to stay up late!</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">us</span><span class="p">(</span><span class="s2">&quot;1969-07-20 22:39&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nx">moonwalk</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>We can parse 7:39 PM in California.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Prime time in California.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">us</span><span class="p">(</span><span class="s2">&quot;1969-07-20 19:39&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Los_Angeles&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nx">moonwalk</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>We can't do Amsterdam, however, because we didn't load its rule set.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Won't work, didn't load Amsterdam.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">us</span><span class="p">(</span><span class="s2">&quot;1969-07-21 03:39&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Amsterdam&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="nx">moonwalk</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Instead of applying Amsterdam's rules, it falls back to UTC.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">us</span><span class="p">(</span><span class="s2">&quot;1969-07-21 02:39&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Amsterdam&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nx">moonwalk</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>But, we can load Amsterdam's rules for just this conversion.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">us</span><span class="p">(</span><span class="s2">&quot;1969-07-21 03:39&quot;</span><span class="p">,</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;timezone/Europe/Amsterdam&quot;</span><span class="p">),</span> <span class="s2">&quot;Europe/Amsterdam&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="nx">moonwalk</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>UNIX Date Formats</h3>

<p>If you provide a format string, the <strong>Timezone</strong> function will return a
formatted date string, instead of POSIX time.</p>

<p><strong>Timezone</strong> implements same date format pattern langauge as GNU's version of
the UNIX <code>date</code> utility. <strong>Timezone</strong> supports the full compliment of <a href="http://en.wikipedia.org/wiki/Date_%28Unix%29">GNU
date</a> format specifiers.</p>

<p>This is the same format language used by the UNIX function <code>strftime</code>. You'll
find a version of <code>strftime</code> in C, Ruby, Python and Perl. With <strong>Timezone</strong>
you can also find a version of <code>strftime</code> in your JavaScript program.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format POSIX time using a GNU date format string.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%m/%d/%Y&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;01/01/2000&quot;</span><span class="p">,</span> <span class="s2">&quot;Date with leading zeros.&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>You can adjust the padding with padding flags.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%-m/%-d/%Y&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;1/1/2000&quot;</span><span class="p">,</span> <span class="s2">&quot;Date without leading zeros.&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Two digit year? Yeah, that's right! I don't <strong>learn</strong> lessons.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%-m/%-d/%y&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;1/1/00&quot;</span><span class="p">,</span> <span class="s2">&quot;Date with two digit year.&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format date and time.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;%m/%d/%Y %H:%M:%S&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;07/21/1969 02:39:00&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Locales</h3>

<p>Timezone supports Locales for formatting dates using the GNU Date format
specifiers.</p>

<p>You apply a locale the same way you apply a timezone. You create a <code>tz</code>
function by passing a locale definition into the <code>tz</code> function.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Add a Polish locale.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">tz</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;languages/pl_PL&quot;</span><span class="p">));</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Time of moonwalk in the default Polish date format.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span> <span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;pl_PL&quot;</span><span class="p">,</span> <span class="nx">tz</span><span class="p">.</span><span class="nx">rf822</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Add a UK, French and German locales.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">tz</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/locales/de_DE&quot;</span><span class="p">),</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/locales/de_DE&quot;</span><span class="p">),</span>
  <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/locales/en_UK&quot;</span><span class="p">));</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Dates for three EU capitols.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span> <span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;de_DE&quot;</span><span class="p">,</span> <span class="s2">&quot;%C&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Berlin&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span> <span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;fr_FR&quot;</span><span class="p">,</span> <span class="s2">&quot;%C&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Paris&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span> <span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;en_UK&quot;</span><span class="p">,</span> <span class="s2">&quot;%C&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/London&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Converting to Wall-Clock Time</h3>

<p>We don't represent wall-clock time using an integer the way we do with POSIX
time. We always write out a string. To create that string we simply specify a
date format.</p>

<p>When we provide a rule set name along with our date format, the <strong>Timezone</strong>
function will adjust the time by the timezone offset, according to the rules,
before formatting the date.</p></td>
          <td class="code"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nx">eu</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;timezone/Europe&quot;</span><span class="p">));</span>

<span class="nx">ok</span><span class="p">(</span> <span class="nx">eu</span><span class="p">(</span><span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;%F %T&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Amsterdam&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1968-07-0X&quot;</span> <span class="p">);</span>

<span class="nx">ok</span><span class="p">(</span> <span class="nx">eu</span><span class="p">(</span><span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;%F %T&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Amsterdam&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;1968-07-0X&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>You can use some common formats to create RFC 3999 strings.</p>

<h3>Converting Between Timezones</h3>

<p>To convert from one timezone to another, we the <code>tz</code> function <strong><em>must be
called twice</em></strong>. Once to convert from the source timezone to POSIX time.
Then again to convert from POSIX time to the destination timezone.</p>

<p>We already did this once when we created <code>y2k</code>. Let's see that again.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse a date in the default UTC timezone. Apply the timezone of Detroit,
Michigan.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">y2k</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000/1/1&quot;</span><span class="p">);</span>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">y2k</span> <span class="o">==</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">);</span>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%m/%d/%Y %H:%M:%S&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;12/31/1999 19:00:00&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Whenever we parse a date, we are parsing that date in the context of a
timezone. If no timezone is specified, we use the default UTC timezone.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Thus, specify your starting timezone when you parse. Then specify your target
timezone when you format.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Convert a walllclock time from Detroit to Warsaw.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span> <span class="s2">&quot;2012-04-01 12:00&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span> <span class="p">),</span> <span class="s2">&quot;Europe/Warsaw&quot;</span><span class="p">,</span> <span class="s2">&quot;%H:%M&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;12:00&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Remember that we can only represent wallclock time using date strings. POSIX
time is an absolute point in time and has no concept of timezone.</p></td>
          <td class="code"><div class="highlight"><pre>

</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Date Math</h3>

<p>In addition to all this, Timezone performs timezone aware date math,
accounting for daylight savings time, leap years and the radical changes to
timezone offsets associated with the politics of time.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Add a millisecond to the epoch.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span> <span class="nx">epoch</span><span class="p">,</span> <span class="s2">&quot;+1 millisecond&quot;</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Travel back in time to the moon walk.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;-30 years&quot;</span><span class="p">,</span> <span class="s2">&quot;-5 months&quot;</span><span class="p">,</span> <span class="s2">&quot;-1 days&quot;</span><span class="p">,</span> <span class="s2">&quot;-1 hours&quot;</span><span class="p">,</span> <span class="s2">&quot;-1 minutes&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">moonwalk</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Jump to the first Saturday after y2k.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;+1 saturday&quot;</span><span class="p">),</span> <span class="s2">&quot;%d&quot;</span> <span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;Friday&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Jump to the first Saturday after y2k, including y2k.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;-1 day&quot;</span><span class="p">,</span> <span class="s2">&quot;+1 saturday&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Moving across daylight savings time by hour, minute, second or millsecond
will adjust your wallclock time.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Moving across daylight savings time by day lands at the same time.</em></p>

<p>Moving across daylight savings time by day, month or year will put you at the
same time, you won't spring forward.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Moving across daylight savings time by day lands at the same time.</em></p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Date Arrays</h3></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Sometimes your input comes not as a stamp, but from a GUI control like a date
picker. You can use <strong>Timezone</strong> to convert a time provided by a timezone
challenged UI control, into a time in the prefered timezone of your user.</p></td>
          <td class="code"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nx">picker</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1969</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">39</span> <span class="p">];</span>

<span class="nx">ok</span><span class="p">(</span> <span class="nx">moonwalk</span> <span class="o">==</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">picker</span><span class="p">)</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Creating Partials</h3>

<p>If you call <code>tz</code> without a date parameter, <code>tz</code> will create a new function
that is a <a href="http://ejohn.org/blog/partial-functions-in-javascript/">partial
application</a> of the
<code>tz</code> function. This is how we load timezones and locales.</p>

<p>We can also use this to create custom functions that are specialized with
<code>tz</code> parameters. This can help use reduce noise in our code, if we are
invoking <code>tz</code> with the same set of parameters over and over again.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format a week of days after Y2K.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;+1 day&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">,</span> <span class="s2">&quot;pl_PL&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;+2 days&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">,</span> <span class="s2">&quot;pl_PL&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Hmm... This is getting tedious. Reduce the noise by creating a partial with
the timezone.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">detroit</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;America/Detroit&quot;</span><span class="p">);</span>

<span class="nx">ok</span><span class="p">(</span> <span class="nx">detroit</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;+3 days&quot;</span><span class="p">,</span> <span class="s2">&quot;pl_PL&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">detroit</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;+4 days&quot;</span><span class="p">,</span> <span class="s2">&quot;pl_PL&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Let's get rid of more chatter by creating a partial with the locale.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">hamtramck</span> <span class="o">=</span> <span class="nx">detroit</span><span class="p">(</span><span class="s2">&quot;pl_PL&quot;</span><span class="p">);</span>

<span class="nx">ok</span><span class="p">(</span> <span class="nx">hamtramck</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;+5 days&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">hamtramck</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;+6 days&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">hamtramck</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;+7 days&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">);</span>

</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Initialization</h3></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Timezones and locales are JSON objects. You can load them however you like.
but I expect that you'll want to do it synchronously. Callbacks are a bit
much for this sort of thing. Consider loading zones and languages something
limited to something, something.</p>

<p>Usually, you'll initialize as part of your require statement. Here in our
example program, we're going to overwrite out <code>tz</code> function to show you the
different forms if one-liner initialization.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Reset</em> <code>tz</code> <em>with a new function that knows about northamerica.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">tz</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz&quot;</span><span class="p">).</span><span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/zones/northamerica&quot;</span><span class="p">));</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>You can add additional zones as needed.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Create a timezone.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">tz</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz&quot;</span><span class="p">).</span><span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/zones/northamerica&quot;</span><span class="p">));</span>
<span class="nx">tz</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/zones/southamerica&quot;</span><span class="p">));</span>
<span class="nx">tz</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/zones/europe&quot;</span><span class="p">));</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Locales are loaded just as timezones are loaded. Pass a locale definition
into the <code>tz</code> function to create a new <code>tz</code> function.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Create a</em> <code>tz</code> <em>with European timezones and Polish locale.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">tz</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz&quot;</span><span class="p">).</span><span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/zones/europe&quot;</span><span class="p">),</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/locales/pl_PL&quot;</span><span class="p">));</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Create a</em> <code>tz</code> <em>with all timezones and locales.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">tz</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz&quot;</span><span class="p">).</span><span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/zones&quot;</span><span class="p">),</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz/locales&quot;</span><span class="p">));</span></pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Maybe your user is in a far off </p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>You easily parse other date formats. </p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse an RFC 822 date.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;Sat, 01 Jan 2000 00:00:00 GMT&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>While Timezone can parse a handful of time looking things, it doesn't do
fuzzy parsing. Natural language is out of scope.</p>

<p>It is good enough to read through most computer generated dates. Log files,
that is. If you're dealing with computer generated date string, you can
usually run them through a regular expression to get them to where Timezone
can read them.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Timezone has some common formats ready to use.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format ISO 8601 date.</em>
eq( tz(moonwalk, tz.iso8601date), "12/31/1999 19:00:00" );</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format ISO 8601 date and time.</em>
ok( tz(moonwalk, tz.iso8601date) === "12/31/1999 19:00:00" );</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format ISO 8601 date, time and milliseconds.</em>
ok( tz(moonwalk, tz.iso8601date) === "12/31/1999 19:00:00" );</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format RFC 822 date.</em>
ok( tz(moonwalk, tz.iso8601date) === "12/31/1999 19:00:00" );</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>RFC 3339, based on ISO 8601, but, like GNU coreutils, taking advantage of the
RFC 3339 caveat to replace the <code>T</code> with a space for readability.
ok( tz(y2k, tz.rfc3339date) == "TK" );</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>GNU date has all sorts of format variables for you to work with.</p>

<p>TK: A few more examples.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Functional Composition</h3></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>You're probably wondering, what about the rest of it? Where's my natural
language processing so I can say "at the next Tuesday after the red barn with
blue tomorrow turn left" and it will know I mean Dyngus Day? My boss wants me to
format dates to say the "2012th Year or Our Lord: Batman" and you don't have
cardinality. Turns out, I do need to get the day of the week as an integer
from a date as cubbyhole.</p>

<p><strong>Timezone</strong> implements a set of standards and de facto standards. It focuses
on getting wall-clock time right. It supports a robust, timezone aware
formatting language, and it it parses an Internet standard date string. With
all the unit tests in place, there is little reason for <strong>Timezone</strong> to grow,
so you can count on its size to be small, under 4k, for the foreseeable
future.</p>

<p>We don't want to grow <strong>Timezone</strong>.</p>

<p>We can, however, easily extend <strong>Timezone</strong> using functional composition.</p>

<p>Let's look at the missing bits.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h4>Cardinality</h4>

<p>We want to print the date as a cardinal number.</p></td>
          <td class="code"><div class="highlight"><pre>

<span class="kd">function</span> <span class="nx">cardinalize</span> <span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">nth</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">date</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">100</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">nth</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="nx">nth</span> <span class="o">&lt;</span> <span class="mi">21</span><span class="p">)</span> <span class="k">return</span> <span class="nx">date</span> <span class="o">+</span> <span class="s2">&quot;th&quot;</span><span class="p">;</span>
  <span class="k">return</span> <span class="nx">date</span> <span class="o">+</span> <span class="p">([</span> <span class="s2">&quot;st&quot;</span><span class="p">,</span> <span class="s2">&quot;nd&quot;</span><span class="p">,</span> <span class="s2">&quot;rd&quot;</span> <span class="p">][(</span><span class="nx">nth</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;th&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%B %-d, %Y&quot;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\d+/</span><span class="p">,</span> <span class="nx">cardinalize</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;January 1st, 2000&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h4>Timezones in Date Strings</h4>

<p>GNU <code>date</code> has a nice feature where you can specify the timezone of a date
string using <code>TZ</code> like so <code>'TZ="America/Detroit" 1999-12-01 20:00'</code>. This
allows you to convert from one timezone to the next in one fell swoop.</p>

<p>Well, we still need to call the <strong>Timezone</strong> function twice, but we can
easily parse those dates with a function.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Extract a specified timezone from a date string.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">tzdate</span> <span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="sr">/^TZ=&quot;(\S+)&quot;\s+(.*)$/</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">date</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="nx">reverse</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">date</span><span class="p">;</span>
<span class="p">}</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse a date with a date string. First one wins.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">eu</span><span class="p">(</span><span class="nx">tzdate</span><span class="p">(</span><span class="s1">&#39;TZ=&quot;Europe/Amsterdam&quot; TK&#39;</span><span class="p">),</span> <span class="s2">&quot;Europe/Paris&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse a date without a date string.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">eu</span><span class="p">(</span><span class="nx">tzdate</span><span class="p">(</span><span class="s1">&#39;TK&#39;</span><span class="p">),</span> <span class="s2">&quot;Europe/Paris&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h4>Plucking Date Fields</h4>

<p>You need the day of the week as a integer. No need to go running back to the
<code>Date</code> object for <code>getUTCDay</code> &mdash; or <code>getDay</code>, have fun with that. You
can create a function to convert the string result to integer, or better
still you can use the one that comes with JavaScript.</p>

<p><em>Get the year as integer.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%Y&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">2000</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Careful to strip leading zeros so it doesn't become octal.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%-d&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Here's your date of week.</em> </p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%-d&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Here's your date of week starting Monday.</em> </p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Plus some things that <code>Date</code> doesn't do, like day of year.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1976-07-04&quot;</span><span class="p">,</span> <span class="s2">&quot;%j&quot;</span><span class="p">))</span> <span class="o">===</span> <span class="mi">186</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h4>Arrays of Date Fields</h4>

<p>What if you want the integer value of a number of different fields?</p></td>
          <td class="code"><div class="highlight"><pre>

<span class="kd">function</span> <span class="nx">array</span> <span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">date</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">});</span>
<span class="p">}</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h4>Additional Date Parsers</h4>

<p>Create a function that returns our date array format.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Timezone can get format values as integers, so if really do need the
component parts of timestamp, you don't need to run back to JavaScript's
<code>Date</code> object.</p>

<p>Wrap your format specifier in a <code>int()</code> cast. </p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Get the month as an integer.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1976-07-04&quot;</span><span class="p">,</span> <span class="s2">&quot;%(%m)&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">7</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>You can do this with any format specifier, so you can get values that
JavaScript's <code>Date</code> can't provide.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Get the day of the year.</em></p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Get the week of the year with Sunday as the start of the week.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1976-07-04&quot;</span><span class="p">,</span> <span class="s2">&quot;%(%U)&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Get the week of the year with Monday as the start of the week.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1976-07-04&quot;</span><span class="p">,</span> <span class="s2">&quot;%(%U)&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>If you need more than one field, you can use an <code>array()</code> cast. Specify the
properties you would like to have returned in an array.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"></td>
          <td class="code"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">deepEqual</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">).</span><span class="nx">deepEqual</span><span class="p">;</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Fetch year, month and date.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">deepEqual</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1976-07-04&quot;</span><span class="p">,</span> <span class="s2">&quot;%[%Y, %m, %d]&quot;</span><span class="p">),</span> <span class="p">[</span> <span class="mi">1974</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span> <span class="p">]</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Fetch year, month, date, hour and minute.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">deepEqual</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;%[%Y, %m, %d, %H, %M]&quot;</span><span class="p">),</span> <span class="p">[</span> <span class="mi">1969</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">39</span> <span class="p">]</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Now that we can pluck fields, we can get a better notion of whether or not it
is is a good time to call Warsaw.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>See if out Detroit call is within office hours in Warsaw.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">hour</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span> <span class="s2">&quot;2012-04-01 12:00&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span> <span class="p">),</span> <span class="s2">&quot;Europe/Warsaw&quot;</span><span class="p">,</span> <span class="s2">&quot;%(%H)&quot;</span> <span class="p">);</span>
<span class="nx">ok</span><span class="p">(</span> <span class="mi">9</span> <span class="o">&lt;</span> <span class="nx">hour</span> <span class="o">&amp;&amp;</span> <span class="nx">hour</span> <span class="o">&lt;</span> <span class="mi">17</span> <span class="p">);</span></pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Working With Timezones</h3></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>The Timezone library uses the <a href="http://www.iana.org/time-zones">IANA Timezone
Database</a>, to create a database of timezone
rules, one per continent, in a compact JSON representation. With it, you can
determine the correct local time, since 1970, of any place in the world.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>To use timezones, you create a new <code>tz</code> function from the existing <code>tz</code>
function. Here we create a new timezone <code>tz</code> that is aware of North America
and Europe.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Create a</em> <code>tz</code> <em>that knows about  North American timezones.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">tz</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;timezone/zones/America&quot;</span><span class="p">),</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;timezone/zones/Europe&quot;</span><span class="p">));</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="s2">&quot;HERE&quot;</span> <span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%m/%d/%Y %H:%M:%S&quot;</span><span class="p">)</span> <span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%m/%d/%Y %H:%M:%S&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">)</span> <span class="p">);</span></pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Now we can format our POSIX time while applying North American timezone
rules.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format POSIX time applying the timezone rules for Detroit, Michigan.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">y2k</span><span class="p">,</span> <span class="s2">&quot;%m/%d/%Y %H:%M:%S&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;12/31/1999 19:00:00&quot;</span> <span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;It worked!&quot;</span><span class="p">);</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>You can see the difference the timezone makes. With it the day of the
moonwalk changes.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format for UTC.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;%m/%d/%Y %H:%M %p&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;12/31/1999 19:00:00&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Format with timezone rules for Merritt Island, Florida.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">moonwalk</span><span class="p">,</span> <span class="s2">&quot;%m/%d/%Y %H:%M %p&quot;</span><span class="p">,</span> <span class="s2">&quot;America/New_York&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;12/31/1999 19:00:00&quot;</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>We use timezone names to parse a date as well.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Local time can only be represented as a string, because POSIX time is always
UTC.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Comparisons Across Timezones</h3></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Always use POSIX time to perform comparisons. Convert from wallclock time to
POSIX time. Let's say you're flying from Vilinus to Vancouver. You ordinarily
live in Vicksburg, so your calandar is scheduled using the Central Time Zone.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Calendar indexed by string representation of POSIX time.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">calendar</span> <span class="o">=</span>
<span class="p">[</span> <span class="nx">tz</span><span class="p">(</span> <span class="s2">&quot;2012/7/8 6:00 PM&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Chicago&quot;</span> <span class="p">),</span> <span class="s2">&quot;Birthday party.&quot;</span>
<span class="p">,</span> <span class="nx">tz</span><span class="p">(</span> <span class="s2">&quot;2012/7/8 3:00 PM&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Chicago&quot;</span> <span class="p">),</span> <span class="s2">&quot;Conference call.&quot;</span>
<span class="p">,</span> <span class="nx">tz</span><span class="p">(</span> <span class="s2">&quot;2012/7/9 8:00 AM&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Chicago&quot;</span> <span class="p">),</span> <span class="s2">&quot;Phone call with Berlin.&quot;</span>
<span class="p">];</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Now you want to know what, if any appointments are going to conflict with
your flight.</p></td>
          <td class="code"><div class="highlight"><pre>

<span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span> <span class="s2">&quot;2012/7/8 6:00 AM&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Vilnius&quot;</span> <span class="p">);</span>
<span class="kd">var</span> <span class="nx">to</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span> <span class="s2">&quot;2012/7/8 6:00 AM&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Vancouver&quot;</span> <span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">stop</span> <span class="o">=</span> <span class="nx">calendar</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">stop</span><span class="p">;</span> <span class="nx">i</span><span class="o">+=</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">when</span> <span class="o">=</span> <span class="nx">calendar</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">from</span> <span class="o">&lt;=</span> <span class="nx">when</span> <span class="o">&amp;&amp;</span> <span class="nx">when</span> <span class="o">&lt;=</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Ooops! You need to reschedule: &quot;</span> <span class="o">+</span> <span class="nx">calendar</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><h3>Storing POSIX Time</h3>

<p>POSIX time is durable and portable. Store it as an integer in any container
that will hold an integer.</p>

<p>Using an <code>INTEGER</code> SQL type to store POSIX time will prevent database engines
with feeble timezone support, like MySQL, from surprising you by applying the
timezone offset of the database server.</p>

<p>If you're having troubles with the <code>TIMESTAMP</code> SQL type, for example, use an
<code>INTEGER</code> to store POSIX time instead. You can share that across all SQL
engines, NoSQL engines, and any POSIX aware programming language.</p>

<p>You can easily compare time for ranges. Your <code>INTEGER</code> comparisions will work
as well as <code>TIMESTAMP</code>, maybe better because you won't be tripped up by the
feeble timezone implementations of some popular database engines. *cough*
MySQL.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Time comparisons are simple.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1970/1/1&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2010/1/1&quot;</span><span class="p">)</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>If you want a string represenation, Timezone is great for date strings too.</p>

<h3>Swipe</h3></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Timezone can parse a number of different date formats.
Import tz function and initialize.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">tz</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;tz&quot;</span><span class="p">).</span><span class="nx">tz</span><span class="p">;</span>
<span class="nx">tz</span><span class="p">.</span><span class="nx">timezones</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./zones/northamerica&quot;</span><span class="p">));</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Parse a UTC date.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">y2k</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000/01/01&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Parse a date offset by a time zone.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">bicentenial</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1976/07/04&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Date math accounting for daylight savings time.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ago</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;6 months ago&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Format the current time.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">tz</span><span class="p">(</span><span class="nx">tz</span><span class="p">.</span><span class="nx">now</span><span class="p">,</span> <span class="s2">&quot;--rfc822&quot;</span><span class="p">);</span>
<span class="nx">eq</span><span class="p">(</span><span class="mi">1976</span><span class="p">,</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">bicentenial</span><span class="p">,</span> <span class="nx">tz</span><span class="p">.</span><span class="kr">int</span><span class="p">,</span> <span class="s2">&quot;%Y&quot;</span><span class="p">));</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Accounts for leap year.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">date</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">bicentenial</span><span class="p">,</span> <span class="s2">&quot;last year&quot;</span><span class="p">);</span> 
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Format using UNIX date formats.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">moonwalk</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1969/06/21 02:36&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Houston&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Accounts for leap year and DST.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">date</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">bicentenial</span><span class="p">,</span> <span class="s2">&quot;last January&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">);</span>
<span class="nx">date</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;now&quot;</span><span class="p">,</span> <span class="s2">&quot;last January&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">);</span>
<span class="nx">date</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="s2">&quot;last January&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Format using a locale.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">bicentenial</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1989/07/14&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Paris&quot;</span><span class="p">,</span> <span class="s2">&quot;fr_FR&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Convert time zones.</p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">bicentenial</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1989/07/14&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Paris&quot;</span><span class="p">),</span> <span class="s2">&quot;America/Detroit&quot;</span><span class="p">,</span> <span class="s2">&quot;%c&quot;</span><span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Also, note that, I'd considered what it meant to go the other way, to parse
timezone offsets. The offsets themselves can be parsed. The timezone
abbreviations cannot be parsed. Something that I'd considered in the past
with the same conclusion. Something I'll consider in the future with the same
conclusion.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Recently, I rediscovered one of my favorite comments from the Olson database...</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><blockquote>
  <p>The UNIX Version 7 "timezone" function is not present in this package; it's
  impossible to reliably map timezone's arguments (a "minutes west of GMT"
  value and a "daylight saving time in effect" flag) to a time zone
  abbreviation, and we refuse to guess.</p>
</blockquote></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>I'm sure I'll ponder whether I'm supposed to support this again at some point
in the future, but in my notes for this commit, I have out of scope written
in all caps. It seems that, when I think about it for a while, I'm angry at
the notion of being responsible for such a thing.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>From the Olson files Theory...</p>

<p>Application writers should note that these abbreviations are ambiguousin
practice: e.g. <code>EST' has a different meaning in Australia than it does in the
United States.  In new applications, it's often better to use numeric UTC
offsets like</code>-0500' instead of time zone abbreviations like `EST'; this
avoids the ambiguity.</p>

<p>Need a place to put maybes.</p>

<p>All natural language processing is OUT OF SCOPE.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>As you saw above</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse a date string and add millisecond.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;+1 millisecond&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="nx">y2k</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>An event that occured in the first full week after Y2K.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-02&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;-1 day&quot;</span><span class="p">,</span> <span class="s2">&quot;+1 monday&quot;</span><span class="p">)</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>Timezone accepts either a POSIX time integer, or else an RFC 3999 date
string. It always returns a POSIX time integer unless a <code>strftime</code> format
string is present.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Note the extra call to <code>tz</code> that does nothing.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;2000-01-01&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nx">y2k</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>When you need the time of the system clock, just call <code>tz()</code> with no
arguments. If you want to do date math or formatting with the current time,
call <code>tz()</code> and pass its return value in as the date argument to another
call to <code>tz</code>.</p></td>
          <td class="code"><div class="highlight"><pre>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Today is greater than yesterday.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">(</span><span class="nx">tz</span><span class="p">(),</span> <span class="s2">&quot;-1 day&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">tz</span><span class="p">()</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Today is greater than the epoch.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">tz</span><span class="p">()</span> <span class="o">&gt;</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1970-01-01&quot;</span><span class="p">)</span> <span class="p">);</span>

<span class="kd">var</span> <span class="nx">moonwalk</span><span class="p">;</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Parse date and time.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">moonwalk</span> <span class="o">=</span> <span class="nx">tz</span><span class="p">(</span><span class="s2">&quot;1969-07-21T02:39&quot;</span><span class="p">);</span></pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p><em>Let's use <code>Date.UTC</code> to check our moon walk timestamp.</em></p></td>
          <td class="code"><div class="highlight"><pre>
<span class="nx">ok</span><span class="p">(</span> <span class="nx">moonwalk</span> <span class="o">===</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">UTC</span><span class="p">(</span><span class="mi">1969</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">39</span><span class="p">)</span> <span class="p">);</span>
</pre></div></td>
        </tr>
      
        <tr>
          <td class="docs"><p>If you need to parse some other form of date string, we've got a way to do
that below, but let's look at timezones first.</p></td>
          <td class="code"><div class="highlight"><pre>

</pre></div></td>
        </tr>
      
    </tbody>
  </table>
</div>
</body>
</html>
